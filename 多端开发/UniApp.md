## uni-app 跨端实践

### 一. cli vs HBuilderX
1. cli创建的项目编译器及相关依赖都在项目下，通过package.json管理，需要手动升级
2. cli创建的项目，可以整个拖入HBuilderX中（如果觉得HBuilderX比vscode好用的话）。编译时走的是项目下的编译器。
3. 网上看到过一种做法，写代码用vscode，发包用HBuilderX。后边尝试下，个人觉得可行。
4. 为什么选择cli方式：混合开发只支持cli方式，个人不喜欢黑盒，方便后期做持续集成

### 二. 开发规范
1. uni使用vue语法 + 小程序标签和API
2. 书写html标签也可以正常运行，但会造成不必要的转译性能开销和可能存在的兼容问题，推荐使用微信小程序原生的`<view>,<text>,<image>...`标签。

### 三. 生命周期
1. 页面声明周期，推荐使用小程序那一套onLoad,onShow  
    1. 推荐使用onLoad替代created
    2. onReady替代mounted
2. 在组件中，页面级生命周期，onLoad，onShow，onReady全部失效。和vue生命周期相同，created/mounted。

### 四. 路由
#### 1. H5 路由错误
uni-app 并没有像 `vue-router` 一样提供一个兜底的错误页跳转，因此当路径错误时，就是始终处在空白页状态，体验不太友好。目前的解决方案是在 `app.vue` 中将异常路由重定向至一个错误页或者首页。
```js
onLaunch: function(options) {
  // #ifdef H5
  if (!options.path) {
    uni.redirectTo({ url: '/'})
  }
  // #endif
}
```

### 五. 页面样式与布局
1. 尺寸单位继续使用rpx，响应式单位
2. 布局尽量使用flex（快应用只支持flex布局）
3. 条件渲染推荐使用 `<template/>` 而不是 `<block/>`，后者存在平台兼容问题
4. `:style="styleObj"` 绑定一个内联的样式对象不生效，不知道原因

### 六. ES6 和 npm、ts
1. 支持 `async/await`  
    异步可以使用 `async/await + promise`，使用 try/catch 来捕获错误
2. 支持npm安装三方包  
    为多端兼容考虑，建议优先从uni-app插件市场获取插件。直接从npm下载库很容易只兼容h5端
3. 支持ts

### 七. 关于组件
1. 不建议继续使用小程序原生自定义组件，使用vue的组件写法，保证更好的兼容和性能

### 八. 条件编译
1. 使用条件编译处理跨端兼容问题  
2. 写法：以 #ifdef 或 #ifndef 加 %PLATFORM% 开头，以 #endif 结尾。
3. 注意不同文件中的注释写法不太一样
4. static 静态文件也支持通过专有目录名称实现条件编译

### 九. 跨端开发注意
1. v-html 在小程序端不支持
2. 在某些特殊情况下，比如`uni.`实现有问题，你依然可以使用`wx.`，但建议只在微信的条件编译区使用`wx.`
3. uni-app 全支持vue语法，所以在vue编译区，你可以随便写
4. 编译为H5版后生成的是单页应用
5. 为避免和内置组件冲突，自定义组件不可以`u-,uni-,wx-...`开头

### 十. 全局页面通讯
1. 页面通讯方面，原生提供了`uni.$emit()`、`uni.$on()`，类似vue的eventBus
2. 使用vuex

### 十一. 数据缓存
1. uni.setStorage，及其他相关api。
    1. h5中使用localStorage
    2. 各小程序为原生的storage api

### 十二. 网络请求
1. uni.request()
2. uni.uploadFile()

### 十三. 踩坑
#### 1. 慎重做一些DOM操作。  
ref和$refs是可用的，但要做一些骚操作，小程序会不兼容
#### 2. 路由的条件编译问题
当你的项目已经支持了多端，新增一个业务页面时，首要做的便是处理好路由的条件编译。你要非常清楚你即将开发的页面会适配哪几个端。例如仅打算适配微信小程序，那你需要将该路由配置为仅微信小程序可见。  
**栗子：** 小王在项目中新增了一个页面，但路由没做任何条件编译处理。而他实际开发时仅考虑了微信小程序的兼容，开发完毕上线，微信小程序一切正常。第二天，小李在同一个项目里，要修改某个H5页面的bug，修改完毕，验证无误，部署上线成功。而此时，昨天小王开发的新页面，在没有对H5做任何兼容的情况下也被带到了线上。一个线上事故就这么发生了。
#### 3. 莫名其妙的问题
1. TODO: 动态class style在小程序端失效

### 十四. 引用
[微信小程序转换uni-app详细指南](https://ask.dcloud.net.cn/article/35786)